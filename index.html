<!DOCTYPE html>
<html>
<head>
  <title>Energy Usage Calculator (2 Meters)</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { cursor: pointer; }
    .section { margin-top: 20px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Energy Usage Calculator (2 Meters)</h2>

  <div class="section">
    <label>Previous Reading – Meter 1 (kWh):</label>
    <input type="number" id="prev1" step="0.01">
    <label>Previous Reading – Meter 2 (kWh):</label>
    <input type="number" id="prev2" step="0.01">
    <label>Previous Date & Time:</label>
    <input type="datetime-local" id="prevTime">
  </div>

  <div class="section">
    <label>Current Reading – Meter 1 (kWh):</label>
    <input type="number" id="curr1" step="0.01">
    <label>Current Reading – Meter 2 (kWh):</label>
    <input type="number" id="curr2" step="0.01">
    <label>Current Date & Time:</label>
    <input type="datetime-local" id="currTime">
  </div>

  <div class="section">
    <button onclick="calculateUsage()">Calculate</button>
  </div>

  <div id="result" class="section" style="white-space: pre-line; font-weight: bold;"></div>

  <script>
    // Load saved previous values on page load
    window.onload = function() {
      document.getElementById("prev1").value = localStorage.getItem("prev1") || "";
      document.getElementById("prev2").value = localStorage.getItem("prev2") || "";
      document.getElementById("prevTime").value = localStorage.getItem("prevTime") || "";

      // Set current date and time
      const now = new Date();
      const offset = now.getTimezoneOffset();
      const localISOTime = new Date(now.getTime() - (offset * 60000)).toISOString().slice(0,16);
      document.getElementById("currTime").value = localISOTime;
    };

    // Save previous readings when user updates them
    document.getElementById("prev1").addEventListener("change", () => {
      localStorage.setItem("prev1", document.getElementById("prev1").value);
    });
    document.getElementById("prev2").addEventListener("change", () => {
      localStorage.setItem("prev2", document.getElementById("prev2").value);
    });
    document.getElementById("prevTime").addEventListener("change", () => {
      localStorage.setItem("prevTime", document.getElementById("prevTime").value);
    });

    function calculateUsage() {
      const prev1 = parseFloat(document.getElementById('prev1').value) || 0;
      const prev2 = parseFloat(document.getElementById('prev2').value) || 0;
      const curr1 = parseFloat(document.getElementById('curr1').value) || 0;
      const curr2 = parseFloat(document.getElementById('curr2').value) || 0;

      const prevTime = new Date(document.getElementById('prevTime').value);
      const currTime = new Date(document.getElementById('currTime').value);

      if (!document.getElementById('prevTime').value || !document.getElementById('currTime').value) {
        document.getElementById('result').innerText = "Please enter both previous and current date/time.";
        return;
      }

      if (currTime <= prevTime) {
        document.getElementById('result').innerText = "Current time must be after previous time.";
        return;
      }

      const used1 = curr1 - prev1;
      const used2 = curr2 - prev2;
      const totalUsed = used1 + used2;

      const msPerDay = 1000 * 60 * 60 * 24;
      const daysPassed = (currTime - prevTime) / msPerDay;

      const avgPerDay = totalUsed / daysPassed;

      const year = currTime.getFullYear();
      const month = currTime.getMonth(); // 0-indexed
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const projectedMonthly = avgPerDay * daysInMonth;

      document.getElementById('result').innerText = `
Results:
Total kWh Used: ${totalUsed.toFixed(2)}
Days Passed: ${daysPassed.toFixed(2)}
Avg Daily Usage: ${avgPerDay.toFixed(2)} kWh
Projected Monthly Usage: ${projectedMonthly.toFixed(2)} kWh
      `;
    }
  </script>
</body>
</html>
